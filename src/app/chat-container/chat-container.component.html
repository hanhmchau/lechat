<mat-progress-bar
    class="progress-bar"
    *ngIf="loading"
    mode="indeterminate"
></mat-progress-bar>
<div class="container">
    <div class="sidebar">
        <mat-tab-group>
            <mat-tab>
                <ng-template mat-tab-label>
                    <mat-icon class="example-tab-icon">chat</mat-icon>
                </ng-template>
                <div *ngFor="let channel of myChannels">
                    <div
                        class="channel"
                        [class.unread]="
                            lastRead ||
                            channel.lastRead < channel.lastMessageSent
                        "
                        [class.active]="activeContactOrChannel === channel.id"
                        (click)="connect(channel.id)"
                    >
                        <div class="channel-avatar">
                            <svg
                                width="40"
                                height="40"
                                [jdenticonHash]="channel.id"
                            ></svg>
                        </div>
                        <div class="channel-name">{{ channel.name }}</div>
                    </div>
                </div>
                <div class="no-conversation" *ngIf="!myChannels.length">
                    You have no conversations yet.
                </div>
            </mat-tab>
            <mat-tab>
                <ng-template mat-tab-label>
                    <mat-icon class="example-tab-icon">person</mat-icon>
                </ng-template>
                <div class="contact" *ngFor="let contact of contacts">
                    <div class="channel" (click)="connect(contact.id)">
                        <div class="channel-avatar">
                            <svg
                                width="40"
                                height="40"
                                [jdenticonHash]="contact.id"
                            ></svg>
                        </div>
                        <div class="channel-name">{{ contact.name }}</div>
                    </div>
                </div>
            </mat-tab></mat-tab-group
        >
    </div>
    <div class="chat">
        <div #messageContainer class="message-container">
            <div class="messages">
                <app-message
                    [message]="message"
                    [me]="me"
                    (onDelete)="delete($event)"
                    (onEdit)="startEditing($event)"
                    *ngFor="let message of messages"
                >
                </app-message>
            </div>
            <div class="is-writing" *ngIf="writingContacts.length">
                {{ writingContacts.join(', ') }}
                {{ writingContacts.length === 1 ? 'is' : 'are' }} writing...
            </div>
        </div>
        <div class="chatbox" *ngIf="activeChannel">
            <button
                class="file-button"
                mat-icon-button
                (click)="triggerInputFile()"
            >
                <mat-icon aria-label="Example icon-button with a heart icon"
                    >attachment</mat-icon
                >
            </button>
            <textarea
                rows="1"
                class="new-message-input"
                #newMessage
                type="text"
                [(ngModel)]="newMsg"
                placeholder="Type a message here"
                (keyup)="isWriting()"
                (keyup.enter)="onMessageSent(newMessage.value)"
                (keyup.esc)="cancelEditing()"
            ></textarea>
            <input #inputFile type="file" (change)="upload($event)" />
            <div class="buttons">
                <button class="emoji-button" mat-icon-button>
                    <mat-icon>tag_faces</mat-icon>
                </button>
            </div>
            <button *ngIf="editing" (click)="cancelEditing()">
                Cancel Edit
            </button>
        </div>
    </div>
</div>
